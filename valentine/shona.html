<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Valentine Proposal üíò</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Poppins", "Segoe UI", sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #ff2e63 0%, #ff6b9d 50%, #ff2e63 100%);
      overflow: hidden;
      color: #fff;
      position: relative;
      animation: gradientShift 10s ease infinite;
      background-size: 400% 400%;
    }

    /* Background hearts */
    .bg-hearts {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .bg-heart {
      position: absolute;
      color: rgba(255, 255, 255, 0.15);
      font-size: 20px;
      animation: floatBg 20s linear infinite;
      opacity: 0;
    }

    /* Heart particles that pop from buttons */
    .heart-particle {
      position: absolute;
      font-size: 24px;
      pointer-events: none;
      z-index: 10;
      animation: heartPop 1.2s ease-out forwards;
    }

    /* Falling hearts for final message */
    .falling-heart {
      position: fixed;
      top: -50px;
      font-size: 30px;
      pointer-events: none;
      z-index: 1999;
      animation: heartFall 8s linear infinite;
    }

    /* Main card */
    .card {
      background: rgba(255, 255, 255, 0.12);
      padding: 35px 25px 45px;
      border-radius: 28px;
      text-align: center;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3),
                  0 0 60px rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      max-width: 500px;
      width: 92%;
      position: relative;
      z-index: 2;
      animation: cardFloat 8s ease-in-out infinite;
    }

    .title-heart {
      font-size: 70px;
      margin-bottom: 15px;
      animation: heartbeat 1.5s ease-in-out infinite;
      text-shadow: 0 0 30px rgba(255, 46, 99, 0.8);
      display: inline-block;
    }

    h1 {
      font-size: 2.3rem;
      margin-bottom: 20px;
      background: linear-gradient(45deg, #fff, #ffe6e6, #fff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 200% auto;
      animation: gradientText 3s ease-in-out infinite;
      font-weight: 800;
      letter-spacing: 1px;
    }

    p.subtitle {
      font-size: 1.2rem;
      font-weight: 500;
      opacity: 0;
      margin-bottom: 0;
      line-height: 1.6;
      padding: 20px;
      border-radius: 20px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.15);
      max-width: 100%;
      margin-left: auto;
      margin-right: auto;
      transform: translateY(30px);
      transition: all 0.8s ease-out;
    }

    p.subtitle.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .buttons-row {
      display: flex;
      justify-content: center;
      gap: 25px;
      margin-top: 30px;
      position: relative;
    }

    button {
      border: none;
      padding: 16px 36px;
      border-radius: 50px;
      font-size: 1.3rem;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
      touch-action: manipulation;
      font-weight: 700;
      letter-spacing: 1px;
      z-index: 1;
      min-width: 160px;
    }

    #yesBtn {
      background: linear-gradient(135deg, #ff2e63 0%, #ff6b9d 100%);
      color: #fff;
      box-shadow: 0 15px 35px rgba(255, 46, 99, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    #yesBtn:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 50px rgba(255, 46, 99, 0.7);
    }

    #yesBtn:active {
      transform: scale(0.95);
    }

    #noBtn {
      background: linear-gradient(135deg, #666 0%, #333 100%);
      color: #fff;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
      border: 2px solid rgba(255, 255, 255, 0.2);
      position: relative;
      z-index: 5;
      transition: transform 0.3s ease, left 0.5s ease, top 0.5s ease;
    }

    #noBtn.escaping {
      position: fixed !important;
      z-index: 1000;
      transition: transform 0.3s ease, left 0.4s ease, top 0.4s ease !important;
    }

    /* Camera overlay */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      z-index: 2000;
      backdrop-filter: blur(10px);
    }

    .overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    .overlay-box {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 30px;
      padding: 35px 30px 40px;
      text-align: center;
      max-width: 500px;
      width: 92%;
      color: #fff;
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(255, 255, 255, 0.2);
      position: relative;
      z-index: 2001;
      transform: scale(0.9);
      transition: transform 0.5s ease;
    }

    .overlay.show .overlay-box {
      transform: scale(1);
    }

    .overlay-title {
      font-size: 1.8rem;
      margin-bottom: 15px;
      color: #ffcc00;
      font-weight: 700;
    }

    .overlay-sub {
      font-size: 1.15rem;
      margin-bottom: 25px;
      opacity: 0.9;
      line-height: 1.6;
      padding: 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 15px;
    }

    .video-wrapper {
      position: relative;
      width: 100%;
      margin-bottom: 25px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    }

    video, canvas {
      width: 100%;
      border-radius: 18px;
      background: #000;
      display: block;
    }

    canvas {
      display: none;
    }

    .capture-btn {
      margin-top: 20px;
      border: none;
      padding: 16px 40px;
      border-radius: 50px;
      background: linear-gradient(135deg, #ffcc00 0%, #ff9900 100%);
      color: #000;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: 700;
      box-shadow: 0 15px 35px rgba(255, 204, 0, 0.5);
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .capture-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 50px rgba(255, 204, 0, 0.7);
    }

    .valentine-message {
      margin-top: 25px;
      font-size: 1.2rem;
      display: none;
      animation: fadeInUp 0.8s ease;
    }

    .cat-kiss-gif {
      width: 300px;
      height: 300px;
      margin: 20px auto;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
      border: 3px solid rgba(255, 255, 255, 0.3);
      animation: floatGif 3s ease-in-out infinite;
    }

    .cat-kiss-gif img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .valentine-line {
      font-weight: 800;
      color: #ffcc00;
      margin-top: 20px;
      font-size: 1.5rem;
      text-shadow: 0 0 20px rgba(255, 204, 0, 0.7);
    }

    /* Fireworks */
    #fireworksCanvas {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 1500;
    }

    /* Animations */
    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      25% { transform: scale(1.2); }
      50% { transform: scale(1.1); }
      75% { transform: scale(1.25); }
    }

    @keyframes gradientText {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    @keyframes cardFloat {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(0.5deg); }
    }

    @keyframes floatBg {
      0% {
        transform: translateY(100vh) rotate(0deg) scale(0.5);
        opacity: 0;
      }
      10% { opacity: 0.3; }
      90% { opacity: 0.3; }
      100% {
        transform: translateY(-100px) rotate(360deg) scale(1.5);
        opacity: 0;
      }
    }

    @keyframes heartPop {
      0% {
        transform: translateY(0) scale(0);
        opacity: 1;
      }
      20% {
        transform: translateY(-20px) scale(1.2);
        opacity: 1;
      }
      100% {
        transform: translateY(-80px) scale(0);
        opacity: 0;
      }
    }

    @keyframes heartFall {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      10% {
        transform: translateY(100px) rotate(10deg);
      }
      20% {
        transform: translateY(200px) rotate(-10deg);
      }
      30% {
        transform: translateY(300px) rotate(15deg);
      }
      40% {
        transform: translateY(400px) rotate(-15deg);
      }
      50% {
        transform: translateY(500px) rotate(20deg);
      }
      60% {
        transform: translateY(600px) rotate(-20deg);
      }
      70% {
        transform: translateY(700px) rotate(25deg);
      }
      80% {
        transform: translateY(800px) rotate(-25deg);
      }
      90% {
        transform: translateY(900px) rotate(30deg);
        opacity: 0.5;
      }
      100% {
        transform: translateY(1000px) rotate(30deg);
        opacity: 0;
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes floatGif {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      33% { transform: translateY(-15px) rotate(1deg); }
      66% { transform: translateY(10px) rotate(-1deg); }
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
      h1 { font-size: 1.8rem; }
      .title-heart { font-size: 55px; }
      p.subtitle { font-size: 1.1rem; padding: 15px; }
      button { 
        padding: 16px 30px; 
        font-size: 1.2rem;
        min-width: 140px;
      }
      .buttons-row { 
        gap: 15px;
        flex-wrap: wrap;
      }
      .overlay-title { font-size: 1.6rem; }
      .card { padding: 30px 20px 40px; }
      .cat-kiss-gif { 
        width: 250px; 
        height: 250px;
      }
    }

    @media (max-width: 480px) {
      h1 { font-size: 1.6rem; }
      button { 
        padding: 14px 25px; 
        font-size: 1.1rem;
        min-width: 130px;
      }
      .cat-kiss-gif { 
        width: 220px; 
        height: 220px;
      }
    }
  </style>
</head>
<body>
  <div class="bg-hearts" id="bgHearts"></div>
  <canvas id="fireworksCanvas"></canvas>

  <div class="card">
    <div class="title-heart">üíò</div>
    <h1>Will you be my Valentine?</h1>

    <p id="subtitle" class="subtitle">
      Par aise nhi‚Ä¶ phele pyaar se puchi de na. üòå
    </p>

    <div class="buttons-row">
      <button id="yesBtn">Haa ji üòç</button>
      <button id="noBtn">Naa ji üôà</button>
    </div>
  </div>

  <!-- Camera overlay -->
  <div class="overlay" id="overlay">
    <div class="overlay-box">
      <div class="overlay-title" id="overlayTitle">Aise nahi, phele puchi de ü•∫</div>
      <div class="overlay-sub" id="overlaySub">
        Ab ek cute sa kissy selfie dedo, tab jaake milta hai Valentine message. üíã
      </div>

      <div class="video-wrapper" id="cameraSection">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
        <button class="capture-btn" id="captureBtn">Kiss de ke capture karo üòò</button>
      </div>

      <div class="valentine-message" id="finalMessage">
        <div class="cat-kiss-gif">
          <img
            src="https://media.giphy.com/media/S3Ot4lN2pO3HG/giphy.gif"
            alt="Cat kissing camera gif"
            loading="lazy"
          />
        </div>
        <div style="font-size:1.3rem;color:#ffcc00;font-weight:700;">Confirm ho gaya, meri Valentine! üíñ</div>
        <div>Selfie bhi aa gayi, ab suno dil se nikal kar aaya message. ‚ú®</div>
        <div style="margin:10px 0;color:#ff6b9d;font-weight:600;">Officially tum meri Valentine ho ab! üíû</div>
        <div class="valentine-line">"Peela chawal le kar rahunga is saal."</div>
        <div style="margin-top:15px;font-size:1rem;opacity:0.9;">
          Ab tum bas ready rehna, baaki sab main sambhal lunga. üí´
        </div>
      </div>
    </div>
  </div>

  <script>
    // DOM Elements
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const subtitle = document.getElementById("subtitle");
    const overlay = document.getElementById("overlay");
    const overlayTitle = document.getElementById("overlayTitle");
    const overlaySub = document.getElementById("overlaySub");
    const cameraSection = document.getElementById("cameraSection");
    const captureBtn = document.getElementById("captureBtn");
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const finalMessage = document.getElementById("finalMessage");
    const bgHearts = document.getElementById("bgHearts");

    // Background hearts
    function createBgHearts() {
      for (let i = 0; i < 10; i++) {
        const heart = document.createElement('div');
        heart.className = 'bg-heart';
        heart.innerHTML = '‚ù§Ô∏è';
        heart.style.left = `${Math.random() * 100}%`;
        heart.style.animationDuration = `${15 + Math.random() * 15}s`;
        heart.style.animationDelay = `${Math.random() * 2}s`;
        heart.style.fontSize = `${15 + Math.random() * 20}px`;
        bgHearts.appendChild(heart);
        
        setTimeout(() => heart.remove(), 20000);
      }
    }

    // Create heart particles that pop from buttons
    function createHeartParticle(x, y, color = '#ff2e63') {
      const heart = document.createElement('div');
      heart.className = 'heart-particle';
      heart.innerHTML = '‚ù§Ô∏è';
      heart.style.left = `${x}px`;
      heart.style.top = `${y}px`;
      heart.style.color = color;
      heart.style.fontSize = `${20 + Math.random() * 20}px`;
      
      // Random direction
      const angle = Math.random() * Math.PI * 2;
      const distance = 50 + Math.random() * 50;
      const targetX = x + Math.cos(angle) * distance;
      const targetY = y - distance;
      
      heart.style.setProperty('--target-x', `${targetX}px`);
      heart.style.setProperty('--target-y', `${targetY}px`);
      
      document.body.appendChild(heart);
      
      // Remove after animation
      setTimeout(() => {
        if (heart.parentNode) {
          heart.remove();
        }
      }, 1200);
    }

    // Create falling hearts from top of page
    function createFallingHearts(count = 15) {
      for (let i = 0; i < count; i++) {
        setTimeout(() => {
          const heart = document.createElement('div');
          heart.className = 'falling-heart';
          heart.innerHTML = '‚ù§Ô∏è';
          
          // Random properties
          const colors = ['#ff2e63', '#ff6b9d', '#ffcc00', '#ff9900', '#ff3366'];
          const color = colors[Math.floor(Math.random() * colors.length)];
          const left = Math.random() * 100;
          const delay = Math.random() * 2;
          const duration = 6 + Math.random() * 4;
          const size = 20 + Math.random() * 30;
          
          heart.style.left = `${left}%`;
          heart.style.color = color;
          heart.style.fontSize = `${size}px`;
          heart.style.animationDelay = `${delay}s`;
          heart.style.animationDuration = `${duration}s`;
          
          document.body.appendChild(heart);
          
          // Remove after animation
          setTimeout(() => {
            if (heart.parentNode) {
              heart.remove();
            }
          }, duration * 1000 + 1000);
        }, i * 200);
      }
    }

    // Fireworks setup
    const fwCanvas = document.getElementById("fireworksCanvas");
    const fwCtx = fwCanvas.getContext("2d");
    let fireworks = [];
    let fwAnimationId = null;

    function resizeCanvas() {
      fwCanvas.width = window.innerWidth;
      fwCanvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // Variables for no button escape
    let stream = null;
    let isEscaping = false;
    let escapeStarted = false;
    let lastEscapeTime = 0;
    const ESCAPE_COOLDOWN = 300; // ms

    // Initialize background
    createBgHearts();
    setInterval(createBgHearts, 3000);

    // Track mouse position
    let mouseX = 0;
    let mouseY = 0;

    document.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
      
      // Check if mouse is near no button
      if (!escapeStarted) return;
      
      const btnRect = noBtn.getBoundingClientRect();
      const btnCenterX = btnRect.left + btnRect.width / 2;
      const btnCenterY = btnRect.top + btnRect.height / 2;
      
      const distance = Math.sqrt(
        Math.pow(mouseX - btnCenterX, 2) + 
        Math.pow(mouseY - btnCenterY, 2)
      );
      
      // If mouse is within 100px of button, escape!
      if (distance < 100) {
        escapeFromCursor();
      }
    });

    // Track touch for mobile
    document.addEventListener('touchmove', (e) => {
      const touch = e.touches[0];
      mouseX = touch.clientX;
      mouseY = touch.clientY;
      
      if (!escapeStarted) return;
      
      const btnRect = noBtn.getBoundingClientRect();
      const btnCenterX = btnRect.left + btnRect.width / 2;
      const btnCenterY = btnRect.top + btnRect.height / 2;
      
      const distance = Math.sqrt(
        Math.pow(mouseX - btnCenterX, 2) + 
        Math.pow(mouseY - btnCenterY, 2)
      );
      
      if (distance < 100) {
        escapeFromCursor();
      }
    }, { passive: true });

    // Simple escape function
    function escapeFromCursor() {
      const now = Date.now();
      if (now - lastEscapeTime < ESCAPE_COOLDOWN) return;
      
      lastEscapeTime = now;
      
      // Switch to fixed positioning if not already
      if (!isEscaping) {
        noBtn.classList.add('escaping');
        isEscaping = true;
      }
      
      // Get button dimensions
      const btnWidth = noBtn.offsetWidth;
      const btnHeight = noBtn.offsetHeight;
      const padding = 50;
      
      // Calculate safe area
      const maxX = window.innerWidth - btnWidth - padding;
      const maxY = window.innerHeight - btnHeight - padding;
      const minX = padding;
      const minY = padding;
      
      // Try to move away from cursor
      let newX, newY;
      let attempts = 0;
      const maxAttempts = 10;
      
      do {
        // Try to move to opposite side of cursor
        newX = mouseX < window.innerWidth / 2 ? 
          Math.random() * (maxX - window.innerWidth/2) + window.innerWidth/2 :
          Math.random() * (window.innerWidth/2 - minX) + minX;
          
        newY = mouseY < window.innerHeight / 2 ?
          Math.random() * (maxY - window.innerHeight/2) + window.innerHeight/2 :
          Math.random() * (window.innerHeight/2 - minY) + minY;
          
        attempts++;
        
        // Ensure minimum distance from current position
        const currentX = parseInt(noBtn.style.left) || btnWidth;
        const currentY = parseInt(noBtn.style.top) || btnHeight;
        const distance = Math.sqrt(Math.pow(newX - currentX, 2) + Math.pow(newY - currentY, 2));
        
        if (distance > 80 || attempts > maxAttempts) break;
      } while (true);
      
      // Apply new position
      noBtn.style.left = `${newX}px`;
      noBtn.style.top = `${newY}px`;
    }

    // No button events - with heart particles
    let hoverCount = 0;
    
    noBtn.addEventListener('mouseenter', () => {
      hoverCount++;
      
      // Create heart particles
      const rect = noBtn.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          createHeartParticle(centerX, centerY, '#666');
        }, i * 100);
      }
      
      if (hoverCount === 1) {
        // First hover: just wiggle
        noBtn.style.transform = 'translateY(-5px)';
        setTimeout(() => {
          noBtn.style.transform = 'translateY(0)';
        }, 300);
      } else if (hoverCount === 2) {
        // Second hover: bigger bounce
        noBtn.style.transform = 'translateY(-10px) scale(1.1)';
        setTimeout(() => {
          noBtn.style.transform = 'translateY(0) scale(1)';
        }, 300);
      } else {
        // Third+ hover: start escape mode
        if (!escapeStarted) {
          escapeStarted = true;
          noBtn.classList.add('escaping');
          isEscaping = true;
          
          // Move to random starting position
          const btnWidth = noBtn.offsetWidth;
          const btnHeight = noBtn.offsetHeight;
          const padding = 50;
          
          const maxX = window.innerWidth - btnWidth - padding;
          const maxY = window.innerHeight - btnHeight - padding;
          const minX = padding;
          const minY = padding;
          
          noBtn.style.left = `${Math.random() * (maxX - minX) + minX}px`;
          noBtn.style.top = `${Math.random() * (maxY - minY) + minY}px`;
        }
      }
    });

    // Yes button with heart particles
    yesBtn.addEventListener('mouseenter', () => {
      // Create heart particles from yes button
      const rect = yesBtn.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      for (let i = 0; i < 8; i++) {
        setTimeout(() => {
          createHeartParticle(centerX, centerY, '#ff2e63');
        }, i * 80);
      }
    });

    // Mobile touch for no button
    noBtn.addEventListener('touchstart', (e) => {
      e.preventDefault();
      hoverCount++;
      
      // Create heart particles
      const rect = noBtn.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          createHeartParticle(centerX, centerY, '#666');
        }, i * 100);
      }
      
      if (hoverCount === 1) {
        // First touch: bounce
        noBtn.style.transform = 'scale(1.1)';
        setTimeout(() => {
          noBtn.style.transform = 'scale(1)';
        }, 300);
      } else if (hoverCount === 2) {
        // Second touch: bigger bounce
        noBtn.style.transform = 'scale(1.2)';
        setTimeout(() => {
          noBtn.style.transform = 'scale(1)';
        }, 300);
      } else {
        // Third+ touch: start escape mode
        if (!escapeStarted) {
          escapeStarted = true;
          noBtn.classList.add('escaping');
          isEscaping = true;
          
          // Move to random position
          const btnWidth = noBtn.offsetWidth;
          const btnHeight = noBtn.offsetHeight;
          const padding = 50;
          
          const maxX = window.innerWidth - btnWidth - padding;
          const maxY = window.innerHeight - btnHeight - padding;
          const minX = padding;
          const minY = padding;
          
          noBtn.style.left = `${Math.random() * (maxX - minX) + minX}px`;
          noBtn.style.top = `${Math.random() * (maxY - minY) + minY}px`;
        }
      }
    }, { passive: false });

    // Mobile touch for yes button
    yesBtn.addEventListener('touchstart', (e) => {
      // Create heart particles from yes button
      const rect = yesBtn.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      for (let i = 0; i < 8; i++) {
        setTimeout(() => {
          createHeartParticle(centerX, centerY, '#ff2e63');
        }, i * 80);
      }
    });

    // Yes button click
    yesBtn.addEventListener('click', async () => {
      // Button animation
      yesBtn.style.transform = 'scale(0.95)';
      
      // Create burst of hearts on click
      const rect = yesBtn.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      for (let i = 0; i < 15; i++) {
        setTimeout(() => {
          createHeartParticle(centerX, centerY, '#ff2e63');
        }, i * 50);
      }
      
      setTimeout(() => {
        yesBtn.style.transform = 'scale(1)';
      }, 200);
      
      // Show subtitle
      subtitle.classList.add('visible');
      
      // Show overlay
      setTimeout(() => {
        overlay.classList.add('show');
        overlayTitle.textContent = "Aise nahi, phele puchi de ü•∫";
        overlaySub.textContent = "Ab ek cute sa kissy selfie dedo, tab jaake milta hai Valentine message. üíã";
        finalMessage.style.display = "none";
        cameraSection.style.display = "block";
      }, 500);

      // Start camera
      try {
        stream = await navigator.mediaDevices.getUserMedia({ 
          video: { 
            facingMode: "user",
            width: { ideal: 1280 },
            height: { ideal: 720 }
          }, 
          audio: false 
        });
        video.srcObject = stream;
      } catch (err) {
        overlaySub.textContent = "Camera allow nahi kiya toh kaise selfie lunga main? ü•≤ (Settings se allow kar dena.)";
      }
    });

    // Download image
    function downloadCanvasImage() {
      const dataURL = canvas.toDataURL("image/png");
      const link = document.createElement("a");
      link.href = dataURL;
      link.download = "hamari-valentine-selfie.png";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Fireworks system
    function createFirework(x, y) {
      const colors = ["#ff2e63", "#ffcc00", "#00ccff", "#ff6b9d", "#cc00ff"];
      const color = colors[Math.floor(Math.random() * colors.length)];
      const particles = [];
      const count = 30 + Math.random() * 20;

      for (let i = 0; i < count; i++) {
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 4 + 2;
        particles.push({
          x: x || Math.random() * fwCanvas.width,
          y: y || Math.random() * fwCanvas.height * 0.4,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          radius: 1.5 + Math.random() * 2,
          alpha: 1,
          color,
          decay: 0.02
        });
      }
      fireworks.push(particles);
    }

    function drawFireworks() {
      fwCtx.fillStyle = 'rgba(0, 0, 0, 0.1)';
      fwCtx.fillRect(0, 0, fwCanvas.width, fwCanvas.height);
      
      fireworks.forEach((particles, idx) => {
        particles.forEach(p => {
          p.x += p.vx;
          p.y += p.vy;
          p.vy += 0.05;
          p.alpha -= p.decay;

          fwCtx.save();
          fwCtx.globalAlpha = p.alpha;
          fwCtx.fillStyle = p.color;
          fwCtx.beginPath();
          fwCtx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
          fwCtx.fill();
          fwCtx.restore();
        });
        
        fireworks[idx] = particles.filter(p => p.alpha > 0);
      });
      
      fireworks = fireworks.filter(p => p.length > 0);
      
      if (fireworks.length > 0) {
        fwAnimationId = requestAnimationFrame(drawFireworks);
      }
    }

    function startFireworks() {
      // Center burst
      createFirework(fwCanvas.width/2, fwCanvas.height/4);
      
      // Surrounding bursts
      for (let i = 0; i < 6; i++) {
        setTimeout(() => {
          const angle = (i / 6) * Math.PI * 2;
          const distance = 120 + Math.random() * 80;
          createFirework(
            fwCanvas.width/2 + Math.cos(angle) * distance,
            fwCanvas.height/4 + Math.sin(angle) * distance
          );
        }, i * 200);
      }
      
      if (!fwAnimationId) {
        fwAnimationId = requestAnimationFrame(drawFireworks);
      }
    }

    // Capture selfie
    captureBtn.addEventListener('click', () => {
      if (!stream) {
        overlaySub.textContent = "Pehle camera allow karo na, fir selfie lenge. ü•π";
        return;
      }

      // Button animation
      captureBtn.style.transform = 'scale(0.95)';
      captureBtn.textContent = 'Capturing... ‚ú®';
      
      setTimeout(() => {
        const track = stream.getVideoTracks()[0];
        const settings = track.getSettings();
        const width = settings.width || 1280;
        const height = settings.height || 720;

        canvas.width = width;
        canvas.height = height;

        const ctx = canvas.getContext("2d");
        ctx.drawImage(video, 0, 0, width, height);
        
        // Add romantic filter
        ctx.fillStyle = 'rgba(255, 46, 99, 0.15)';
        ctx.fillRect(0, 0, width, height);
        
        // Add text
        ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
        ctx.font = 'bold 30px Poppins';
        ctx.textAlign = 'center';
        ctx.fillText('Meri Valentine üíñ', width/2, height - 60);
        
        ctx.font = '20px Poppins';
        const today = new Date();
        ctx.fillText(today.toLocaleDateString('hi-IN'), width/2, height - 25);

        // Stop camera
        stream.getTracks().forEach(t => t.stop());
        stream = null;

        // Download
        setTimeout(() => downloadCanvasImage(), 300);

        // Show final message
        video.style.display = 'none';
        canvas.style.display = 'none';
        cameraSection.style.display = 'none';
        captureBtn.style.display = 'none';
        
        overlayTitle.textContent = 'Confirm ho gaya, meri Valentine! üíñ';
        overlaySub.textContent = 'Selfie bhi aa gayi, ab suno dil se nikal kar aaya message. ‚ú®';
        finalMessage.style.display = 'block';

        // Start celebration - fireworks and falling hearts
        startFireworks();
        
        // Start falling hearts from top
        createFallingHearts(20);
        
        // Continue falling hearts every few seconds
        const fallingHeartsInterval = setInterval(() => {
          createFallingHearts(5);
        }, 2000);
        
        // Stop after 30 seconds
        setTimeout(() => {
          clearInterval(fallingHeartsInterval);
        }, 30000);
        
        // Add background hearts
        for(let i = 0; i < 15; i++) {
          setTimeout(() => createBgHearts(), i * 100);
        }
      }, 500);
    });

    // Make sure no button starts in correct position
    window.addEventListener('load', () => {
      // Reset no button position
      noBtn.style.position = 'relative';
      noBtn.style.left = '';
      noBtn.style.top = '';
      noBtn.style.transform = '';
      
      // Add initial heart particles on page load
      setTimeout(() => {
        const rect = yesBtn.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        for (let i = 0; i < 3; i++) {
          setTimeout(() => {
            createHeartParticle(centerX, centerY, '#ff2e63');
          }, i * 300);
        }
      }, 1000);
    });
  </script>
</body>
</html>